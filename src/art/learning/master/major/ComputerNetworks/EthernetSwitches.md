---
title: 以太网交换机
date: 2025-07-22
icon: 'earth-americas'
order: 19
category: 
    - '408'
    - '计算机网络'
    - 考研
---

## 特点

- 交换机等同于多端口网桥

- 交换机工作在数据链路层，可以根据目的 MAC 地址转发帧

- 交换机的每个端口通常都支持**全双工模式**，除非连接的是**集线器**

- 交换机通过交换表记录 MAC 地址和端口号的关系，以达到正确转发帧的目的

- 交换机通过学习机制自动更新交换表

## 自学习功能

一个标准的 V2 以太网 MAC 帧： 6 6 2 N 4 ，收发协数验

假设以下情况：

以节点字母代号代表其具体 MAC 地址

节点之间互相知道彼此的 MAC 地址，并依次发送以下帧：

1. $A \rightarrow C$

2. $B \rightarrow C$

3. $C \rightarrow A$

4. $H \rightarrow A$

5. $H \rightarrow C$

6. $C \rightarrow H$

7. $J \rightarrow \text{广播}$

8. $K \rightarrow J$

![交换机自学习示例图](https://store.s1r0ko.top/svg/m/cn/19/1_ver_1.svg)

开始时，两台交换机各自维护的交换表均为空，如下：

| 交换机端口号 | 1 | …… | 8 |
| :---: | :---: | :---: | :---: |
| MAC 地址 | NULL | …… | NULL |

1. 收到 $A \rightarrow C$ 帧，学习到 $A$ 的 MAC 地址，将 $A$ 的 MAC 地址和端口号 $1$ 记录到交换表中，此时由于交换表中没有 $C$ 的记录，所以将该帧向全部连接的子节点发送出去，所有节点除 $C$ 外接收到该帧都会丢弃，并且由于其连接到交换机 2 所以交换机也会重复这一步骤，由于交换机 2 的交换表没有记录过该帧发送方的 MAC 地址并且该帧从端口 1 进入，所以交换机 2 会将该帧的发送方 MAC 地址，也就是 $A$ 的 MAC 地址映射记录到端口 1 上，此时双方的交换表应该是这样的

![当前交换表状态](https://store.s1r0ko.top/svg/m/cn/19/2_ver_1.svg)

2. 收到 $B \rightarrow C$ 的处理和步骤 1 类似，此时交换机 1 做的操作就是记录 $B$ MAC 地址然后广播，交换机 2 的操作也是记录 $B$ MAC 地址然后广播，所以双方的交换表应该是这样的：

![当前交换表状态](https://store.s1r0ko.top/svg/m/cn/19/3_ver_1.svg)

3. 交换机 1 收到 $C \rightarrow A$ 帧时，交换表中没有 $C$ 于是记录 $C$，由于接收方已经存在交换表中，于是交换机 1 将帧只转发到端口 1 

![当前交换表状态](https://store.s1r0ko.top/svg/m/cn/19/4_ver_1.svg)

4. 交换机 2 收到 $H \rightarrow A$ 帧时，交换表中没有 $H$ 于是记录 $H$，由于接收方已经存在交换表中，于是交换机 2 将帧只转发到端口 1 ，此时交换机 1 收到 $H \rightarrow A$ 帧时，由于交换表没有 $H$ 帧记录，于是记录该地址和端口，接收方 $A$ 已在交换表内，于是直接转发到端口 1 去

![当前交换表状态](https://store.s1r0ko.top/svg/m/cn/19/5_ver_1.svg)

5. 交换机 2 收到 $H \rightarrow C$ 帧时，不记录 $H$ ，由于 $C$ 不在交换表 2 内，于是进行广播，到达交换机 1 后，不登记 $H$ ，并且直接向 $C$ 发送

![当前交换表状态](https://store.s1r0ko.top/svg/m/cn/19/5_ver_1.svg)

6. 交换机 1 收到 $C \rightarrow H$ 帧时，不记录 $C$ ，直接发给端口 8 ，交换机收到帧后，由于没有 $C$ 记录，于是登记 $C$ ，然后直接转发给端口 2

![当前交换表状态](https://store.s1r0ko.top/svg/m/cn/19/6_ver_1.svg)

7. 交换机 2 收到 $J$ 发送的广播帧，记录 $J$ 位置，然后广播发送（发送到除入口外的所有端口），交换机 1 收到 $J$ 发送的广播帧，记录 $J$ 位置，然后广播发送

![当前交换表状态](https://store.s1r0ko.top/svg/m/cn/19/7_ver_2.svg)

8. $K$ 向集线器发送 $K \rightarrow J$ 帧，此时由于这两台设备连接同一个集线器，集线器向所有端口发送该帧， $J$ 不需要经过交换机即可接收到，交换机 2 收到 $K \rightarrow J$ 帧，交换机 2 记录 $K$ ，由于发送方和接收方在同一端口，于是不进行再次转发

![当前交换表状态](https://store.s1r0ko.top/svg/m/cn/19/8_ver_1.svg)

假设此时， $H$ 由交换机 2 的端口 2 转移到交换机 1 的端口 7 

每个交换表中的项都有设置有效期，过期后该项作废，可以解决这个换接口导致发送失败的问题，或者此时更新位置的节点发送了一个帧，交换机收到这个帧后发现此 MAC 地址的端口号变了，就会覆盖原来的端口号

## 交换方式

交换机如何根据 MAC 地址转发帧？

### 直通交换

仅读取帧的前 6 个字节存入高速缓存，并检查交换表，发送到对应端口，类似于电路交换

- 优点：转发时延低

- 缺点：不适用于需要速率匹配、协议转换或差错检测的线路

### 存储转发交换

将这个帧存储到高速缓存中，读取前 6 个字节，进行转发操作，期间也可以对帧进行差错检测等其他复杂操作

- 优点：适用于需要速率匹配、协议转换或差错检测的线路

- 缺点：转发时延高

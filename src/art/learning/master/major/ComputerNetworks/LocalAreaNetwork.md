---
title: 局域网
date: 2025-07-17
icon: 'earth-americas'
order: 18
category: 
    - '408'
    - '计算机网络'
    - 考研
---

## IEEE

IEEE （Institute of Electrical and Electronics Engineers）是美国电子工程师协会

局域网技术与其旗下的 IEEE 802 委员会关系密切，其职责是推进局域网技术的标准化，其下属也拥有多个工作组负责不同的局域网技术标准化工作，例如：

- **802.8 工作组**

负责 FDDI 光纤数字接口技术的标准化工作

- **802.5 工作组**

负责令牌环网技术的标准化工作

- **802.3 工作组**

负责以太网技术的标准化工作

- **802.11 工作组**

负责 WI-FI 技术的标准化技术

对于其不同的标准化结果，其颁布了许多标准，例如：

| 年份 | 标准名 | 通俗名称 |
| :---: | :---: | :---: |
| 1999 | 802.11 b | WIFI-1 |
| 1999 | 802.11 a | WIFI-2 |
| 2003 | 802.11 g | WIFI-3 |
| 2009 | 802.11 n | WIFI-4 |
| 2013 | 802.11 ac | WIFI-5 |
| 2021 | 802.11 ax | WIFI-6 |
| 2024 | 802.11 be | WIFI-7 |

## 局域网的基本概念和结构体系

将从以下几个点来了解局域网

### 局域网的特点

1. 覆盖较小的地理范围

2. 较低的时延和误码率

3. 局域网内的各节点间以“帧”为单位进行传输

4. 支持单播、广播、多播

    - 单播：一对一发送帧

    - 广播：一对全部发送帧

    - 多播：一对多（非全部）发送帧

### 局域网的分类

::: tip

对于每种具体的局域网分类，我们需要着重关注以下几个点：

- **拓扑结构**

- **传输介质**

- **介质访问控制方式**

:::

1. **有线局域网（LAN）**

::: info 令牌环网（Token Ring）（1984 - 2000）

| 拓扑结构 | 传输介质 | 介质访问控制方式 |
| :---: | :---: | :---: |
| 环型 | 同轴电缆 或 双绞线 | 令牌传递协议 |

:::

::: info 以太网 / 802.3 （Ethernet）

- 物理层采用**曼彻斯特编码**

**同轴电缆以太网（1980s）**{#blue-msg}

| 拓扑结构 | 传输介质 | 介质访问控制方式 | 采用标准 |
| :---: | :---: | :---: | :---: |
| 总线型 | 同轴电缆或用中继器连接的多个同轴电缆网段 |  CSMA/CD 协议 | 10Base5（1982） |

**双绞线以太网（1980后期）**{#blue-msg}

| 拓扑结构 | 传输介质 | 介质访问控制方式 | 采用标准 | 时间 | 连接方式 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| 物理上星型，逻辑上总线型 | 双绞线 | CSMA/CD 协议 | 10BaseT（1990） | 应用前期 | 集线器连接 |
| 物理上逻辑上均为星型 | 双绞线 | CSMA/CD 协议 或 NULL[^1] | 10BaseT（1990） | 1994年后 | 交换机连接 | 

**光纤以太网（1990s）**{#blue-msg}

用以扩大以太网的覆盖范围

| 拓扑结构 | 传输介质 | 介质访问控制方式 | 采用标准 |
| :---: | :---: | :---: | :---: |
| 点对点[^2] | 光纤 | NULL[^3] | 10BaseF（1993） |

[^1]: 半双工模式下采用 CSMA/CD 协议，全双工模式下不采用协议

[^2]: 用于中继器/集线器/交换机之间的传输，也就是说通常不会直接连接终端节点

[^3]: 由于采用两条光纤实现全双工通信，不存在信道争用的情况，所以不需要介质访问控制

:::

2. **无线局域网（WLAN）**

::: info WIFI / 802.11

| 拓扑结构 | 传输介质 | 介质访问控制方式 | 采用标准 |
| :---: | :---: | :---: | :---: |
| IEEE 802.11 定义为星型[^4] | 无线电磁波 | CSMA/CA 协议 | 802.11 * 协议 |

[^4]: 1 台 AP 和 N 台移动设备

:::

### 局域网的硬件架构

![局域网架构图](https://store.s1r0ko.top/svg/m/cn/18/1_ver_1.svg)

- 主存中的 IP 地址，**可能会发生变化**

- 即将发送到网络上的帧或者即将从网络上接收到的帧会先缓存到各网络适配器的 RAM 中

- 个元件 ROM 中的 MAC 地址[^5]为**全球唯一**物理地址， 48 bit

- 网络适配器（又称：网络接口卡、网卡）

    - **负责把帧发送到局域网**。注：关于“将 IP 数据报（ IP 分组）封装成帧”，有些系统由主机实现，有些系统由网络适配器负责，

    - **负责从局域网接收帧**。如果收到正确帧，就用“中断”通知 CPU ；如果收到异常帧，就直接丢弃

    - 需要根据接入的局域网类型，按照标准实现数据链路层和物理层的功能

    - 需要完成数据的串 / 并行转换

    - 需要支持缓冲帧

[^5]: 全球 MAC 地址由 IEEE 管理分配，共 48 bit ，硬件厂商需申请 MAC 地址段，申请得来的 MAC 地址段前 24 bit 为厂商号，后 24 bit 由厂商进行分配

## 局域网与 IEEE 802.3

**各传播介质的适用情况**{#blue-msg}

| 标准名称 | 10BASE5 | 10BASE2 | 10BASE-T | 10BASE-F |
| :---: | :---: | :---: | :---: | :---: |
| 传输媒体 | 同轴电缆（粗缆） | 同轴电缆（细缆） | 非屏蔽双绞线 | 光纤对（850nm） |
| 编码 | 曼彻斯特编码 | 曼彻斯特编码 | 曼彻斯特编码 | 曼彻斯特编码 |
| 拓扑结构 | 总线型 | 总线型 | 星型 | 点对点 |
| 最大段长 | 500m | 185m | 100m | 2000m |
| 最多结点数目 | 100 | 30 | 2 | 2 |

**几种高速以太网技术（速率 $>$ 100 Mbps）**{#blue-msg}

<table style="text-align: center;">
    <thead style="font-weight: bold;">
        <tr>
            <td>标准名称</td>
            <td>100Base-T以太网</td>
            <td>吉比特以太网</td>
            <td>10吉比特以太网</td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>传输速率</td>
            <td>100Mb/s</td>
            <td>1Gb/s</td>
            <td>10Gb/s</td>
        </tr>
        <tr>
            <td>传输介质</td>
            <td>双绞线</td>
            <td>双绞线或光纤</td>
            <td>双绞线或光纤</td>
        </tr>
        <tr>
            <td>通信方式</td>
            <td colspan="2">支持半双工和全双工方式</td>
            <td>只有全双工方式</td>
        </tr>
        <tr>
            <td>介质访问控制协议</td>
            <td colspan="2">半双工方式下使用CSMA/CD协议</td>
            <td>无</td>
        </tr>
    </tbody>
</table>

- 同轴电缆只能半双工工作

- 双绞线视情况而定

    - 速率 $< 2.5$ Gbps 可支持半双工 or 全双工（节点连接时协商）

    - 速率 $\geq 2.5$ Gbps 仅支持支全双工

    - **做题时，默认交换机连接的终端节点都可以全双工**{#red-msg}

    - **使用集线器的节点，仅支持半双工**{#red-msg}

- 光纤只支持全双工

### 常见的以太网 MAC 层标准

IEEE 802 将数据链路层分为三个层次

<table>
    <tbody>
        <tr>
            <td><del>逻辑链路控制子层（已弃用）</del></td>
        </tr>
        <tr>
            <td>介质访问控制子层</td>
        </tr>
        <tr>
            <td>物理层</td>
        </tr>
    </tbody>
</table>

- ~~逻辑链路控制子层（LLC层） 已名存实亡~~ 

- **物理层** 和 **介质访问控制子层** 并称为 MAC 层
    
    - DEC 、 Intel 、Xerox 推出 **DIX Ethernet V2**{#red-msg} 标准 （市面上最常用的标准）

    - IEEE 802.3 在上面的标准的基础上做出略微修改，推出了 IEEE 802.3 系列标准

### V2 标准的以太网 MAC 帧

![V2 标准的以太网 MAC 帧结构示意图](https://store.s1r0ko.top/images/m/cn/18/1_ver_1.png)

- 图中的数字均表示 **字节 （Byte）** 的数量

- 目的地址代表接收方 MAC 地址、源地址为发送方 MAC 地址

- 目的地址如果全为 1 ，则会被局域网内全部节点接收，那么这种帧被称为**广播帧**，反之有确定的目的地址的为**单播帧**

- 协议的两个字节指明**网络层**的协议，在 802.3 标准中，这个位置两个字节指明数据部分的长度，指明协议的功能交由 LLC 子层去完成

- 由于在以太网传输中可能会使用 [CSMA/CD 协议](/art/learning/master/major/ComputerNetworks/MediaAccessControl.html#csma-cd-协议)进行数据传输，因此需要对数据部分的长度进行限制

- 数据如果太长无法使用一帧完成传输，就需要对数据进行分片；同样的，如果数据太短，就需要对空余部分使用 0 进行填充

- 最后 4 个字节用于差错控制，存储 CRC 校验码

- MAC 帧的长度范围为 $64 \sim 1518$ 字节（B）

- 以太网的物理层帧会在 MAC 帧的基础上，在帧前添加 8 字节的前导码（ 7 字节**前同步码**和 1 字节的**帧开始定界符**）

- 前同步码的主要作用是确认一个电信号节奏与接收方进行协调，内容为：10101010……

- 帧结尾定界采用“违规编码法”（即使用[曼彻斯特编码](/art/learning/master/major/ComputerNetworks/CodingAndModulation.html#常用编码方法)的违规编码），且一个帧传完会留一段间隙

记忆口诀： **6 6 2 N 4 ， 收发协数验， N 是四六一千五**

### 帧的传播

![示例网络拓扑图](https://store.s1r0ko.top/svg/m/cn/18/2_ver_2.svg)

这里需要注意的是： **MAC 地址是数据链路层的概念，路由器和交换机都有 MAC 地址，集线器则没有**{#red-msg}

::: info 单播帧

$C_1 \rightarrow C_3$ ，仅 $C_3$ 能收到并接收帧

$C_1 \rightarrow C_6$ ，$C_5, C_6, C_7$ 能收到，仅 $C_6$ 会接收帧

$C_5 \rightarrow C_1$ ，$C_1, C_6, C_7$ 能收到，仅 $C_1$ 会接收帧

$C_5 \rightarrow C_6$ ，$C_6, C_7$ 能收到，仅 $C_6$ 会接收帧

:::

::: info 广播帧（目的地址全为 1 ）

$C_1$ 发出广播帧，$C_2, C_3, C_4, C_5, C_6, C_7, R_1$ 都会接收帧

$C_5$ 发出广播帧，$C_1, C_2, C_3, C_4, C_6, C_7, R_1$ 都会接收帧

:::

::: warning

路由器收到广播帧后，不会再转发至其他网络；只有同一个局域网内的各节点才属于一个**广播域**

:::

- 冲突域：如果两个节点同时发送数据，会导致冲突，则二者处于同一个冲突域中，**交换机**{#blue-msg}可以隔离**冲突域**{#blue-msg}

- 广播域：如果一个节点发送广播帧，可以被另一个节点接收，则二者处于同一个广播域中，**路由器**{#blue-msg}可以隔离**冲突域**{#blue-msg}和**广播域**{#blue-msg}

## VLAN （虚拟局域网） 

对于一个传统的大型局域网（如学校内部网络），节点众多，通常这些节点都由交换机连接，但出现多个节点发送广播帧时，大量信息会充斥信道，造成信道超负荷，为了避免**广播风暴**

同时局域网内的一些敏感节点也容易暴露在互联网中

为了解决上述的两个问题 IEEE 802.1Q 工作组提出了 VLAN 的概念，旨在通过将局域网内部各个节点进行分组，组成新的局域网来隔离各个不同功能的节点

- 将多个节点划分为同一组别（VLAN），每个 VLAN 是一个广播域

- 每个 VLAN 都对应着一个 VID

- 划分 VLAN 需要通过支持 VLAN 技术的以太网交换机来实现

### 划分 VLAN 的方式

![基于接口划分 VLAN ](https://store.s1r0ko.top/svg/m/cn/18/3_ver_2.svg)

::: info 基于接口

交换机内的数据结构会记录 VID 和各个接口的映射关系

| VID | S1 接口 | S2 接口 |
| --- | --- | --- |
| 10 | 1, 2, 3, 4, 8 | 1, 2, 3 |
| 20 | 5, 6, 7, 8 | 1, 5, 6, 7 |

S1 包含接口 8 是因为有部分具有此 VID 的节点位于连接接口 8 的交换机上，同样道理 S2 包含接口 1 

交换机收到来自某 VID 的节点的广播后会向包含在同 VID 数据结构内的其他节点发送数据，位于其他交换机上的节点可以通过直接发送数据到该交换机，该交换机会转发到对应 VID 的子节点上

这种方法有个缺点，就是一旦某个节点更换了和交换机连接的接口，那么这个节点就再也不属于这个 VLAN 了

:::

::: info 基于 MAC 地址

为了解决 基于接口 的缺点，基于 MAC 地址的 VLAN 划分方法应运而生

交换机内部会维护一个 MAC 地址到 VID 的映射关系

| VID | S1 维护的 MAC | S2 维护的 MAC |
| --- | --- | --- |
| 10 | A, B, C, D, H, I | A, B, C, D, H, I |
| 20 | E, F, G, J, K, L | E, F, G, J, K, L |

当交换机收到广播帧时，会根据发送广播帧的来源节点的 MAC 地址，判断其所属的 VLAN 并发送给对应节点或对应节点的交换机

:::

::: info 基于 IP 地址

和基于 MAC 相似，交换机内部会维护一个 IP 地址到 VID 的映射关系

| VID | S1 维护的 IP | S2 维护的 IP |
| --- | --- | --- |
| 10 | A, B, C, D, H, I | A, B, C, D, H, I |
| 20 | E, F, G, J, K, L | E, F, G, J, K, L |

由于 IP 是网络层的概念，因此实现该功能要求交换机拥有网络层的功能支持，并且这种方式可以让 VLAN 的范围跨越路由器，让多个局域网内的不同主机组成一个 VLAN 

:::

### 802.1Q 帧

如果一个帧需要跨域交换机传输，那么该帧需要遵从 802.1Q 帧的格式，在帧中指明 VID 

在跨越交换机时，发送方交换机会在[标准以太网帧](/art/learning/master/major/ComputerNetworks/LocalAreaNetwork.html#v2-标准的以太网-mac-帧)的源地址和协议类型的两个位置中间插入一个 4 字节的 VLAN 标签，指明该帧所属的 VLAN 并且重新生成 CRC 码，因为插入了 VLAN 标签该帧的内容已经改变，先前的 CRC 码已经失效；接收方交换机会在收到该帧并判断处理完成后去除这个部分，然后转发给对应的主机或主机所属的交换机


![802.1Q 帧结构](https://store.s1r0ko.top/images/m/cn/18/2_ver_1.png)

- VLAN 标签分为两个部分，前 2 字节固定为 0x8100 表明该帧为 802.1Q 帧，后 2 字节的前 4 位可以填任何信息，后 12 位为发送方所属的 VLAN 的 VID

802.1Q 帧的结构为 6 6 4 2 N 4 ，新口诀为：6 6 4 2 N 4 ，收发 V 协数验 

## IEEE 802.11 无线局域网

无线局域网分为两种：

- 有固定基础设施的无线局域网——如 802.11 无线局域网（ WIFI ）

- 无固定基础设施的移动自组织网络——如苹果隔空投送、华为分享等

### 802.11 无线局域网的结构 

![家庭局域网结构](https://store.s1r0ko.top/svg/m/cn/18/4_ver_2.svg)

家用路由器 = 路由器 + 以太网交换机 + AP

实际上 AP 等同于无线网络交换机

以太网交换机和其子节点通关有限链路组成一个 802.3 局域网， AP 和其子节点通过无线网络链路组成一个 802.11 局域网

两个局域网需要通过 **门户（Portal）** 设备组成一个更大的局域网， Portal 具有网桥的功能，主要负责完成两个不同局域网的协议转换，这里是将 802.11 局域网转换成 802.3 局域网

### 基本概念

![802.11 无线局域网结构拓扑](https://store.s1r0ko.top/svg/m/cn/18/5_ver_1.svg)

- 802.11 无线局域网是**星型拓扑**，中心称为**接入点（ AP ）**，也可以称为**无线接入点（ WAP ）**

- 基本服务集 BSS ： 1 个基站（ AP ） + 多个移动站（ 设备 ）

    - 服务集标识符 SSID ： 无线局域网的标识，不超过 32 B

    - 基本服务区 BSA ： 一个基本服务集能够覆盖到的地理范围

- 扩展服务集 ESS ： 将多个 AP 连接到同一个分配系统，组成一个更大的服务集

- 漫游 ： 一个移动站从一个基本服务集切换到另一个基本服务集，仍然可以保持通信

### 802.11 帧的分类

802.11 采用 [CSMA/CA 协议](/art/learning/master/major/ComputerNetworks/MediaAccessControl.html#csma-ca-协议)，帧的类型基于该协议规定需要的帧，加上一些额外的帧

- 数据帧

- 控制帧：如 ACK 、 RTS 、 CTS

- 管理帧：如 探测请求帧 / 探测响应帧[^6]

::: warning

在 802.11 协议下，两个移动站之间是不能直接进行通信的，必须通过 AP 进行转发

AP 通常具有将 802.11 帧转换为以太网帧的能力

:::

[^6]: 探测请求帧为节点在为连接到 AP 时向四周发送的一种帧，如果该帧被 AP 成功接收到， 此时 AP 会返回**探测响应帧**给源节点

::: info 数据帧

![802.11 数据帧结构图](https://store.s1r0ko.top/images/m/cn/18/3_ver_1.png)

记忆口诀：30 N 4 首数验，首部 3 + 1 地址；九十[^7]比特表去来，帧的中转靠 AP ；去往 AP 中起止[^8]，来自 AP 止中起

[^7]: 第九个和第十个 bit 

[^8]: 
    - 中：中转节点 MAC 地址，这里指 AP 的 MAC 地址

    - 起：源发送节点 MAC 地址

    - 止：目的接收节点 MAC 地址

    这三个字的顺序分别代表着：地址 1 、地址 2 、地址 3 三个位置的内容

802.11 数据帧由三个部分组成，分别为： MAC 首部，数据部分， MAC 尾部

- 帧控制部分

    - 协议版本：不需要深究，是一个基本固定的值
    
    - 类型：帧的类型
    
    | 帧类型 | 10 | 01 | 00 |
    | :---: | :---: | :---: | :---: |
    | bit | 数据帧 | 控制帧 | 管理帧 |
    
    - 子类型：该帧具体类型
    
    | bit | 0000 | 1011 | 1100 | 1101 | …… |
    | :---: | :---: | :---: | :---: | :---: | :---: |
    | 帧子类型 | 数据帧 | RTS | CTS | ACK | …… |
    
    - 去往 AP 和来自 AP
    
    | 数据与 AP 的关系 | 去往 AP 位 | 来自 AP 位 |
    | :---: | :---: | :---: |
    | 去往 AP | 1 | 0 |
    | 来自 AP | 0 | 1 |
    
    - **后面几位的含义不需要详细了解**{#red-msg}

- 地址 1 ：该帧当前接收方 MAC 地址

- 地址 2 ：该帧当前发送方 MAC 地址

- 地址 3 ：该帧的最终接收方 / 该帧最起始发送方 MAC 地址

- **地址 4 在有固定基站的网络中没有作用（即 802.11 局域网中没有作用），不需要重点关注**{#red-msg}

:::

::: info 其他帧

- RTS 帧

| 字节 | 2 | 2 | 6 | 6 | 4 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| 含义 | 帧控制 | 持续期[^9] | 接收地址 | 发送地址 | FCS |

[^9]: 表示在本帧结束后还需占用信道多少时间（以微秒为单位）

- CTS 帧

| 字节 | 2 | 2 | 6 | 4 |
| :---: | :---: | :---: | :---: | :---: | 
| 含义 | 帧控制 | [持续期](/art/learning/master/major/ComputerNetworks/LocalAreaNetwork.html#footnote9) | 发送地址 | FCS |

- ACK 帧

| 字节 | 2 | 2 | 6 | 4 |
| :---: | :---: | :---: | :---: | :---: | 
| 含义 | 帧控制 | [持续期](/art/learning/master/major/ComputerNetworks/LocalAreaNetwork.html#footnote9) | 发送地址 | FCS |

:::

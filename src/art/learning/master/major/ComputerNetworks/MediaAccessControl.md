---
title: 介质访问控制
date: 2025-07-16
icon: 'earth-americas'
order: 17
category: 
    - '408'
    - '计算机网络'
    - 考研
---

- **介质访问控制**

介质访问控制（Medium Access Control）简称 MAC ，多个节点共享同一个“总线型”广播信道时，可能发生“信号冲突”

为了解决信号冲突问题，才有了介质访问控制的概念

介质范围控制有三种类型：信道划分、随机访问、轮询访问

## 信道划分

### 时分复用（TDM）

时分复用（Time Division Multiplexing）简称 TDM —— 将时间分为**等长的“ TDM 帧”**，每个“ TDM 帧”又分为**等长的 $m$ 个“时隙”**，将 $m$ 个时隙分配个 $m$ 对用户（节点）使用

- **缺点**

    - 每个节点最多只能分配到信道总带宽的 $\frac{1}{m}$

    - 如果某个节点暂时不发送数据，会导致被分配的“时隙”闲置，信道利用率低

### 统计时分复用（STDM）

统计时分复用（Statistical Time Division Multiplexing）简称 STDM —— 又称异步时分复用，在 TDM 的基础上，动态按需分配时序

- **优点**

    - 如果需要时，一个节点可以在一段时间内获得所有的信道带宽资源

    - 如果某节点暂时不发送数据，可不分配“时隙”，信道利用率高

### 频分复用（FDM）

频分复用（Frequency Division Multiplexing）简称 FDM —— 是将信道的总频带划分为多个子频带，每个频带作为一个子信道，每对用户使用一个子信道进行通信

- **优点**

    - 各节点可同时发送信号；充分利用了信道带宽（Hz）

- **缺点**

    - FDM 技术只能用于模拟信号的传输

### 波分复用（WDM）

波分复用（Wave Division Multiplexing）简称 WDM —— 即光的频分复用，光信号的频带范围很大，很适合采用波分复用技术，将一根光纤在逻辑上拆分为多个子信道

### 码分复用（CDM）

```markmap
---
markmap:
    colorFreezeLevel: 3
    maxWidth: 400
---

# 码分复用

## 给各节点分配专属“码片序列”

### “码片序列”包含 m 个码片（信号值），可看作 **“m维向量”（m维向量的分量通常取1或-1）**

### 要求：各节点的“ m 维向量”**必须相互正交**

### tips：相互通信的各节点知道彼此的“码片序列”

## 发送方如何发送数据

### 节点发出 m 个信号值**与“码片序列”相同**，表示**比特1**

### 节点发出 m 个信号值**与“码片序列”相反**，表示**比特0**

## 信号在传输过程中的“叠加”

### 当多个发送方同时发送数据时，信号值会叠加（本质是多个m维向量的加法）

## 接收方如何接收数据

### 接收方收到的是“叠加”信号，需要从中“分离”出各发送方的数据

### **叠加信号**与**发送方的码片序列**作“规格化内积”

- **结果为 1 表示比特 1**

- **结果为 -1 表示比特 0**

```

假设有 A 、 B 、 C 三个基站

下面给三个基站分配其各自的码片序列

| 基站 | 码片序列 | 二进制 1 表示 | 二进制 0 表示 |
| :---: | :---: | :---: | :---: |
| A | $\vec{a} = (1, 1, 1,  1)$ | $\vec{a}$ | $-\vec{a}$ |
| B | $\vec{b} = (1, -1, 1, -1)$ | $\vec{b}$ | $-\vec{b}$ |
| C | $\vec{c} = (1, 1, -1, -1)$ | $\vec{c}$ | $-\vec{c}$ |

此时 C 站收到三个信号 $(1, 1, 1, 1), (-1, -1, -1, -1), (1, 1, 1, 1)$

由于每个站内都有保存各自的码片序列且码片序列的分量都是正交的（内积为 0 ），因此可以很容易的分辨出信号的来源

假设 C 站同时收到两个信号 $\vec{a} = (1, 1, 1, 1), -\vec{b} (-1, 1, -1, 1)$ ，它收到的信号应该是两者的叠加值即 $\vec{a} + (-\vec{b}) = (0, 2, 0, 2)$

为了分离出各自的信息需要先使用各个基站的码片对传输结果进行规格化内积

首先计算基站 A 

$$
\begin{aligned}


\text{基站 C 收到的信号与基站 A 码片序列的内积} &= \frac{1}{m} \cdot \vec{a} \cdot (\vec{a} + (-\vec{b})) \\

&= \frac{1}{m} \cdot \vec{a} \cdot \vec{a} \\

&= \frac{1}{4} \cdot 4 \\

&= 1

\end{aligned}
$$

根据规格化内积 1 即比特 1 、内积 -1 即比特 0

同样的可以得到基站 B 传来的信号进行规格化内积为 -1 即比特 0 

## 随机访问

### ALOHA 协议

发送方的发送数据准备好就马上发送数据、如果同时有两个数据发生冲突会导致两个数据都无法被正确接收，然后随机等待一段时间后再触发重传，在不断地试错下完成各个数据的发送

### 时隙 ALOHA 协议

和 ALOHA 协议相同但是它将时间划分为一个个“时隙”，节点可以在一个“时隙”内的任意时间确认发送数据，并且在下一个“时隙”发送数据，并且一个时隙内一定能发送完一个帧，如果发生冲突，节点会随机等待一段时间后再发送数据，在不断地试错下完成各个数据的发送

时隙 ALOHA 避免了用户发送数据的随意性，降低了冲突概率，提高了信道的利用率

### CSMA 协议

CSMA （Carrier Sense Multiple Access）协议，即**载波监听多路访问协议**

其在 ALOHA 协议的基础上进行改进：**在发送数据前，先监听信道是否空闲，只有信道空闲时，才会尝试发送**{#blue-msg}

各个节点会先安装**载波监听装置**监听信道

### 1-坚持 CSMA 协议

坚持代表在信道不空闲时是否坚持对信道进行监听

坚持监听的 CSMA 协议

![1-坚持 CSMA 协议流程图](https://store.s1r0ko.top/svg/m/cn/17/1_ver_1.svg)

- **优点**

信道利用率高，信道一旦空闲，就可以被下一个节点使用

- **缺点**

当多个节点同时准备好发送数据时，一旦信道空闲，会有多个节点同时发送数据，会造成发生冲突的概率大大增加

### 非坚持 CSMA 协议

为了解决 1-坚持 CSMA 协议的监听冲突问题，才有了非坚持 CSMA 协议

![非坚持 CSMA 协议流程图](https://store.s1r0ko.top/svg/m/cn/17/2_ver_1.svg)

- **优点**

当多个节点都准备好数据时，如果信道不空闲，则各节点会**随机推迟一段时间再尝试监听**，从而使**各节点“错开”发送数据**。降低冲突概率

- **缺点**

信道刚恢复空闲时，可能不会被立即利用，导致信道利用率低

### p-坚持 CSMA 协议

结合1-坚持和非坚持的优点改进而成的p-坚持协议

这里的 $p$ 指的是在信道空闲时，有多大的概率发送数据

![p-坚持 CSMA 协议流程图](https://store.s1r0ko.top/svg/m/cn/17/3_ver_2.svg)

- **优点**

属于 1-坚持 CSMA 、非坚持 CSMA 的折中方案，降低冲突概率的同时提升信道利用率

### **CSMA/CD 协议**{#red-msg} [:scream: :thumbsup:](./MediaAccessControl.html#符号意义) 

CSMA/CD （Carrier Sense Multiple Access with **Collision Detection**{#blue-msg}）协议，即**载波监听多路访问协议** / **冲突检测**

常用于早期有线以太网[（总线型）](./ClassificationOfComputerNetworks.html#按拓扑结构分类)

```markmap
---
markmap:
    colorFreezeLevel: 4
    maxWidth: 450
---

# CSMA/CD 协议

## 协议要点

### 先听后发，边听边发，**冲突停发**，**随机重发**

### 如何随机重发

- [截断二进制指数退避算法](./MediaAccessControl.html#截断二进制指数退避算法)

### 特别注意

- 第 10 次冲突，是“随机重发”的分水岭

- 第 16 次冲突，直接躺平，放弃传帧，报告上级（网络层）

## $\text{争用期} = 2 \times \text{最大单向传播时延} \\ \text{（考虑距离最远的两个节点）}$

### 若争用期内未发生冲突，就不可能再冲突

### CSMA/CD 没有 ACK 机制，若**发送过程中未检测到冲突，就认为帧发送成功**

## $\text{最短帧长} = 2 \times \text{最大单向传播时延} \times \text{信道带宽}$

### 若收到的帧小于最短帧长，则视为无效帧

## 最长帧长：规定最长帧长可防止某些节点一直占用信道

## 以太网规定

### 最短帧长：64B；最长帧长：1518B （B：字节）

```

![CSMA/CD 协议发送方流程图](https://store.s1r0ko.top/svg/m/cn/17/4_ver_1.svg)

这里的等待时间由[截断二进制指数退避算法](./MediaAccessControl.html#截断二进制指数退避算法)计算得出

可以见得由于冲突次数越大，当前的网络环境可能就越拥堵，因此需要等待的时间的可能取值范围就越大，以尽量避免过于拥堵的网络环境

![CSMA/CD 协议接收方流程图](https://store.s1r0ko.top/svg/m/cn/17/5_ver_1.svg)

### **CSMA/CA 协议**{#red-msg} [:scream:](./MediaAccessControl.html#符号意义)

CSMA/CA （Carrier Sense Multiple Access with **Collision Avoidance**{#blue-msg}）协议，即**载波监听多路访问协议** / **冲突避免**

该协议适用于 IEEE 802.11 无线局域网 （WIFI）

```markmap
---
markmap:
    colorFreezeLevel: 4
    maxWidth: 450
---

# CSMA/CA 协议

## 协议要点

### 发送方：先听后发，忙则退避

- 若信道*空闲*，间隔 DIFS ，再发送帧（**一口气发送完，发送过程中不用检测冲突**）

- 若信道不空闲，则进行**“随机退避”**

### **随机退避**原理

- 1.用[二进制指数退避算法](./MediaAccessControl.html#截断二进制指数退避算法)确定一段随机退避时间（倒计时）

- 2.发送方会保持监听信道，**只有信道空闲时才“扣除倒计时”**，倒计时接收后立即发送帧（此时信道“听起来”一定空闲）

### 接收方：停止等待协议

- 每收到一个正确数据帧都返回 ACK ；若发送方超时未收到 ACK ，则进行“随机退避”

## 信道预约机制（可选功能）

### 1.**发送方**广播 **RTS 控制帧（先听后发，忙则退避）**

### 2.[AP](./MediaAccessControl.html#ap) 广播 **CTS 控制帧**

### 以上两种须在 RTS 和 CTS 中指明预约时长

### 3.其他*无关节点*收到 CTS 后自觉“*禁言*”一段时间（即：虚拟载波监听机制）；发送方收到 CTS 后，就可以发送数据帧

### 4.[AP](./MediaAccessControl.html#ap) 收到数据帧后，进行 CRC 校验，若无差错就返回 ACK 帧
 
## 帧间间隔 IFS

### **DIFS**，最长的 IFS

- 每次“帧”事务开始之前都需要等待时间

### SIFS，最短的 IFS

- 收到最后一个真后需要预留一段处理时间

### ~~PIFS，中等长度的 IFS~~

- ~~考研不需要关注~~

```

无线信号的使用场景下， CSMA/CD 协议很难实现不同设备间的信号随着距离增加而减弱，对于监听而言是不利的，硬件上很难实现；

同时存在**隐藏节点**的问题，设备之间不一定检测到彼此的信号

因此采用传统的 CSMA/CD 协议无法适应无线局域网的需求

IFS （Inter Frame Space），帧间间隔

DIFS （Distributed Inter Frame Space），分布式协调 IFS ，最长的帧间间隔，发送前等待一段时间以确保没有从远处传播并且此时自身无法监听到的数据占用信道，一般取值大于 SIFS + 传播时延 

SIFS （Short Inter Frame Space），短 IFS ，最短的帧间间隔，预留 SIFS 用于处理收到的帧（如进行差错控制等）

DIFS > PIFS > SIFS

![CSMA/CA 传输示例图](https://store.s1r0ko.top/svg/m/cn/17/6_ver_1.svg)

假设一种情况

- DIFS = 4 ms

- 传播时延 2 ms

- SIFS 1 ms （该时间片大小由 IEEE 802.11 标准规定，这里假设为 1 ms）

在信道繁忙时会进行随机退避，在退避过程中也将坚持监听，并且会累计空闲时长，当空闲时长达到随机退避时间时，才会进行帧的发送

由于无线传播过程中容易受到干扰，所以在接收到数据后一定要对帧做差错控制，这里的 SIFS 也是为此而生

![CSMA/CA 传输示例图（含预约功能）](https://store.s1r0ko.top/svg/m/cn/17/7_ver_1.svg)

同样的情况，启用信道预约功能的传输过程如上图所示

这里引入两个新的帧类型：

- RTS 控制帧（Request To Send）请求发送：包含源地址、目的地址和这次通信所需要的**持续时间**

- CTS 控制帧（Clear To Send）允许发送：包含源地址、目的地址和这次通信所需要的**持续时间**

1. 完成等待时发送 RTS 向 AP 请求信道

2. AP 进行处理后，同意预约，向全体子节点发送 CTS 

3. 发送方收到 CTS 后开始发送数据，其他节点收到后，停止接下来的发送工作

4. AP 完成接收后将发送 ACK 给所有子节点，代表已完成数据收发

5. 所有子节点解除停止发送状态，回到正常工作

::: warning

一些需要注意的点

- 如果发送方超时未收到 CTS ，说明预约失败，则“随机退避”后再次发送 RTS

- “先预约，再发送”这种模式可以启用、也可以不启用，在 IEEE 802.11 标准中，是否启用这个功能取决于该数据帧的长短（长度达到某个阈值后才会启用）

:::

## 轮询访问

### 令牌传递协议

IBM 公司于 1984 年开发出一种局域网技术：令牌环网技术

该技术核心特点是：环形拓扑结构，各节点“轮询访问”信道，不会发生信道冲突

实现该技术的核心就是：令牌传递协议

```markmap
---
markmap:
    colorFreezeLevel: 4
    maxWidth: 450
---

# 令牌传递协议

## 协议要点（数据帧和令牌帧在发送数据时可以互相转换）

### 令牌帧

- 需要指明当前**获得令牌的节点编号**

- 只有获得令牌（Token）的节点才能往信道上发送数据帧

- 如果获得令牌的节点**没有数据要发送**，就**将令牌传递给下一个节点**

### 数据帧

- 需要指明数据帧的**源地址/目的地址、是否已被接收、获得令牌的节点编号**

- 数据帧从源节点出发，“传递一圈”后回到源节点

- 数据帧“传递一圈”的过程中，会被**目的节点**复制一份数据，并将数据帧标记为“**已接收**”

- 数据帧回到源节点后，如果发现**异常**情况，就尝试**重发**；若**无异常**，就**将令牌传递给下一节点**

## 其他补充

### 无论是令牌帧还是数据帧，都只能沿单向传递

### 获得令牌的节点，每次只能发送一帧，发完必须释放令牌

### 需要专门的网络设备（MAU）实现**集中控制**

### 令牌传递协议很**适用于负载高**的网络（不会发生冲突，效率高）

```

在一个局域网内，只有一台设备持有令牌，只有持有令牌的设备才能使用信道进行通信

每次发送数据都会从发送方开始依次轮询接下来信道上的每个节点，各个节点会对数据和接收方mac地址进行校验，接收后会对帧内部分数据进行修改然后继续轮询，直到回到最初的发送方

## 补充内容

一些补充内容

### 符号意义

本章内容标 :scream: 代表难点 :thumbsup: 代表重点

### 截断二进制指数退避算法

$\text{随机等待一段时间} = r \text{倍争用期，其中} r \text{是随机数}$

- 如果 $k \le 10$，在 $[0, (2^k - 1)]$ 区间随机取一个整数 $r$

- 如果 $k > 10$，在 $[0, (2^{10} - 1)]$ 区间随机取一个整数 $r$

### 争用期

$\text{争用期} = 2 \times \text{最大单向传播时延（考虑距离最远的两个节点）}$

如果在争用期内没有检测到冲突，则本次帧发送就不再可能发送冲突

### AP 

AP （Access Point），即**接入点**，平时的提供WIFI信号源，WIFI的那几根天线的接收端，所有的移动站点都需要固定站点 AP 来进行通信

家用路由器 = 路由器 + 交换机 + AP



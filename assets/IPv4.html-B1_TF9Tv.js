import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as o,d as a,a as i,b as e,e as n,w as d,r as p,o as l}from"./app-BH7mjjZS.js";const c={};function m(h,t){const r=p("RouteLink");return l(),o("div",null,[t[3]||(t[3]=a('<h2 id="ipv4-协议" tabindex="-1"><a class="header-anchor" href="#ipv4-协议"><span>IPv4 协议</span></a></h2><figure><img src="https://store.s1r0ko.top/svg/m/cn/20/1_ver_1.svg" alt="各层协议之间关系" tabindex="0" loading="lazy"><figcaption>各层协议之间关系</figcaption></figure><div class="hint-container tip"><p class="hint-container-title">提示</p><p>各层协议之中， <strong id="red-msg">IP 协议（Internet Protocol）是互联网的核心</strong></p><p>ARP 协议用于查询同一网络中的 <code>&lt;主机 IP 地址, MAC 地址&gt;</code> 之间的映射关系</p><p>ICMP 协议用于网络层实体之间互相通知“异常事件”</p><p>IGMP 协议用于实现 IP 组播</p></div><h2 id="ip-数据报的格式" tabindex="-1"><a class="header-anchor" href="#ip-数据报的格式"><span>IP 数据报的格式</span></a></h2><figure><img src="//store.s1r0ko.top/svg/m/cn/20/2_ver_2.svg" alt="IP 数据报的格式" tabindex="0" loading="lazy"><figcaption>IP 数据报的格式</figcaption></figure><p>IP 数据报分为<strong>首部</strong>和<strong>数据部分</strong>两个部分</p><p>首部的结构如图所示</p><div class="hint-container info"><p class="hint-container-title">首部</p><p>首部分为固定部分和可变部分两个部分</p><p>固定部分长度为 <strong>20 字节</strong>，可变部分长度为 <strong>0 ~ 40 字节不等</strong></p><p>各部分详解：</p><ul><li>固定部分</li></ul><table><thead><tr><th>字段名</th><th>bit 位数</th><th>说明</th></tr></thead><tbody><tr><td>版本</td><td>4</td><td>用于区分网络层使用的 IP 协议版本，使用二进制表示 4 就是 IPv4 协议，使用二进制表示 6 就是 IPv6 协议</td></tr><tr><td>首部长度</td><td>4</td><td>用于指示 IP 数据报的首部长度，单位为 4B，例如：一个首部长度为 20 B 的 IP 数据报，这里的内容为二进制表示的 5 即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>×</mo><mn>4</mn><mi>B</mi><mo>=</mo><mn>20</mn><mi>B</mi></mrow><annotation encoding="application/x-tex">5 \\times 4B = 20B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">4</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">20</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></td></tr><tr><td><s>区分服务</s></td><td>8</td><td><s>一般用不到， 408 不考</s></td></tr><tr><td>总长度</td><td>16</td><td>表示范围 0 ~ 65535 单位为 1B ，表示整个 IP 数据报的长度（首部 + 数据部分）</td></tr><tr><td>标识</td><td>16</td><td>由 IP 数据报的“源主机”生成，通常是自增序列，相当于一个数据报的识别码，数据报进行分片时，各分片的标识码必须相同</td></tr><tr><td>标志<sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup></td><td>3</td><td>三个 bit 分别为三个不同含义，最低位 MF 、 次低位 DF 、 最高位不需要了解意思，具体指代详见脚注 1，假设一个标志位为 001 则分别为最高位、 次低位 MF 、 最低位 DF</td></tr><tr><td>片偏移</td><td>13</td><td>表示该数据部分在“被分片”之前所处的位置，以 8 B 为单位</td></tr><tr><td>生存时间</td><td>8</td><td>代表该数据报在网络中可通过的路由器数的最大值。常记为 TTL<sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup></td></tr><tr><td>协议</td><td>8</td><td>表示当前数据报正在为哪一个协议服务，如果是 TCP 该值设置为 6 、 如果是 UDP 该值设置为 17</td></tr><tr><td>首部校验和</td><td>16</td><td>经过的每个路由器都会对首部进行校验（不校验数据部分），如果该字段全设为 0 ，表示不用校验；校验和的计算方法与 UDP 相同</td></tr><tr><td>源地址</td><td>32</td><td>发送主机的 IP 地址</td></tr><tr><td>目的地址</td><td>32</td><td>接收主机的 IP 地址</td></tr></tbody></table><ul><li>可变部分</li></ul><table><thead><tr><th>字段名</th><th>bit 位数</th><th>说明</th></tr></thead><tbody><tr><td>填充</td><td>不定长</td><td>用于将 IP 数据报首部填充至 4B 的整数倍</td></tr></tbody></table></div><div class="hint-container info"><p class="hint-container-title">数据部分</p><p>数据部分长度范围：0 B ~ ( 65535 - 20 ) B ，扣掉的 20 B 为首部的最小长度，值不需要记</p><p>上面只是受到首部总长度字段的限制，也就是<strong>理论最大值</strong>，实际上 IP 数据报的长度通常会受到数据链路层的最短 / 长帧长的限制</p></div>',9)),i("p",null,[t[1]||(t[1]=e("一个数据链路层数据帧能承载的最大数据量称为最大传输单元（MTU）。如")),n(r,{to:"/art/learning/master/major/ComputerNetworks/LocalAreaNetwork.html#v2-%E6%A0%87%E5%87%86%E7%9A%84%E4%BB%A5%E5%A4%AA%E7%BD%91-mac-%E5%B8%A7"},{default:d(()=>t[0]||(t[0]=[e("以太网帧")])),_:1}),t[2]||(t[2]=e(" MTU = 1500 B"))]),t[4]||(t[4]=a('<p>如果一个 IP 数据报总长度超出了下一段链路的 MTU 就需要进行分片处理，依次传递这些分片给下一个节点</p><p>拆分时需要注意需要按 MTU 大小减去 IP 数据报的首部长度，得到的数据部分长度才是分片后的数据长度</p><div class="hint-container warning"><p class="hint-container-title">注意</p><ul><li><p>IP 数据报的“分片”可能在源主机或任何一个路由器中发生</p></li><li><p>只有目的主机才会对分片进行**“重组”**</p></li><li><p>各分片有可能以乱序到达目的主机</p></li><li><p>由于首部“片偏移”字段是以 <strong>8 B</strong> 为单位，因此，除<strong>最后一个分片</strong>外，其他每个分片的数据部分必须是 <strong>8 B</strong> 的整数倍</p></li><li><p><strong id="red-msg">当标志位 DF = 1 且下一段数据链路层数据帧长也无法满足这一份数据报时，路由器会选择丢弃该数据报，并且向源主机发送 ICMP 报文代表发生异常发送失败</strong></p></li><li><p>4 1 8，首部长度 4B 为单位，总长度 1B 为单位，片偏移 8B 为单位</p></li></ul></div><h2 id="ip-地址详解" tabindex="-1"><a class="header-anchor" href="#ip-地址详解"><span>IP 地址详解</span></a></h2><p>IP 地址是一个 32 位的二进制数，通常用点分十进制的形式表示，例如： 192.168.1.1</p><p>IP 地址资源由 ICANN（互联网名字与数字分配机构）进行分配（有偿分配）</p><p>ICANN 将 IP 地址分为以下几类（如图）：</p><figure><img src="//store.s1r0ko.top/svg/m/cn/20/3_ver_1.svg" alt="IP 地址分类" tabindex="0" loading="lazy"><figcaption>IP 地址分类</figcaption></figure><div class="hint-container info"><p class="hint-container-title">IP 地址</p><p>一个 IP 地址由两部分组成： 网络号 + 主机号</p><p>这两个号不定长，需要根据不同种类的 IP 地址而定</p><table><thead><tr><th>IP 地址类型</th><th>网络号长度</th><th>主机号长度</th><th>网络号前几位固定位</th><th>前八位表示的十进制数范围</th></tr></thead><tbody><tr><td>A 类</td><td>8 位</td><td>24 位</td><td>0</td><td>0 ~ 126</td></tr><tr><td>B 类</td><td>16 位</td><td>16 位</td><td>10</td><td>128 ~ 191</td></tr><tr><td>C 类</td><td>24 位</td><td>8 位</td><td>110</td><td>192 ~ 223</td></tr><tr><td>D 类</td><td>无</td><td>无</td><td>1110</td><td>224 ~ 239</td></tr><tr><td>E 类</td><td>无</td><td>无</td><td>1111</td><td>240 ~ 255</td></tr></tbody></table></div><div class="hint-container warning"><p class="hint-container-title">注意</p><ul><li><p>在早期互联网时代，每台主机，每个路由器接口被分配的 IP 地址都是全球唯一的</p></li><li><p>路由器和路由器连接的接口可以不分配 IP 地址，但路由器和其他节点连接的接口必须分配 IP 地址</p></li><li><p>从属于同一个网络的所有主机、路由器接口和 IP 地址“网络号”都相同</p></li><li><p>当一台新主机接入网络时，需要给他分配一个 IP 地址、并配置“默认网关”</p></li></ul></div><ul><li><p>单播地址：每一个 IP 对应一台主机</p></li><li><p>多播地址：每一个 IP 可以分配给一个主机群，向一个多播地址发送信息，就是向这一群主机发送信息</p></li></ul><h3 id="ip-转发示例" tabindex="-1"><a class="header-anchor" href="#ip-转发示例"><span>IP 转发示例</span></a></h3><p>假设有如下网络拓扑：</p><figure><img src="//store.s1r0ko.top/svg/m/cn/20/4_ver_2.svg" alt="IP 转发示例" tabindex="0" loading="lazy"><figcaption>IP 转发示例</figcaption></figure><ul><li><p>某学校被分配的 IP 网络号为 <code>166.1.0.0</code></p></li><li><p>某公司被分配的 IP 网络号为 <code>200.1.1.0</code></p></li></ul><p>现有一个 IP 数据报从 H1 发送到 H7，结构如下：</p><table><thead><tr><th>源 IP</th><th>目的 IP</th></tr></thead><tbody><tr><td>166.1.0.1</td><td>200.1.1.2</td></tr></tbody></table><p>过程大致如下：</p><ol><li><p>H1 完成数据报的组装后比较网络段和自身网络段是否处在一个局域网内，发现不是，所以发往网关（每个节点都会保存该局域网的网关 IP ），组帧需要目的 MAC 地址，通过 ARP 协议可以根据节点内部的网关 IP 获取到网关 MAC 地址，完成组帧后发往连接该节点的交换机</p></li><li><p>交换机获取到 MAC 帧后，会根据 MAC 转发到网关</p></li><li><p>网关收到多个 MAC 帧并完成组装 IP 数据报后，会根据目的 IP 地址查询转发表转发到对应端口</p></li><li><p>根据图片可知，此时学校网关有到达目的网段的路由，所以会将数据报发往该路由，发往公司的网关</p></li><li><p>公司路由器收到该数据报，确认是发往公司网段，此时通过组帧可以获取到目标 IP 主机的 MAC 地址，发送 MAC 帧发往公司的交换机</p></li><li><p>交换机确认 MAC 地址，发送到对应主机</p></li></ol><p>现有一个 IP 数据报从 H1 发送到 H6，结构如下：</p><table><thead><tr><th>源 IP</th><th>目的 IP</th></tr></thead><tbody><tr><td>166.1.0.1</td><td>166.1.4.4</td></tr></tbody></table><ol><li><p>H1 组装完数据报后，检查到目的 IP 和自己处于同一个网段中，于是通过 ARP 协议获取到目的 IP 主机的 MAC 地址，组帧后发往交换机</p></li><li><p>交换机收到数据报后，会根据 MAC 地址直接转发到 H6 或下一个交换机节点</p></li></ol><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p>标识位含义对照表：</p><table><thead><tr><th>标志位</th><th>值</th><th>含义</th></tr></thead><tbody><tr><td>MF</td><td>0</td><td>表示当前分片是 IP 数据报的最后一个分片</td></tr><tr><td>MF</td><td>1</td><td>表示当前分片不是 IP 数据报的最后一个分片，后面还有分片</td></tr><tr><td>DF</td><td>0</td><td>表示 IP 数据报可以进行分片</td></tr><tr><td>DF</td><td>1</td><td>表示 IP 数据报不能进行分片</td></tr></tbody></table><a href="#footnote-ref1" class="footnote-backref">↩︎</a></li><li id="footnote2" class="footnote-item"><p>生存时间 TTL ：</p><ul><li>TTL 的初始值通常由源主机设置</li><li>每经过一个路由器， TTL 就会减 1</li><li>当 TTL 减为 0 时，该数据报就会被丢弃，并且向源主机发送 ICMP 报文代表发生异常发送失败</li></ul><a href="#footnote-ref2" class="footnote-backref">↩︎</a></li></ol></section>',24))])}const I=s(c,[["render",m]]),f=JSON.parse('{"path":"/art/learning/master/major/ComputerNetworks/IPv4.html","title":"IPv4","lang":"zh-CN","frontmatter":{"title":"IPv4","date":"2025-07-23T00:00:00.000Z","icon":"earth-americas","order":20,"category":["408","计算机网络","考研"],"description":"IPv4 协议 各层协议之间关系各层协议之间关系 提示 各层协议之中， IP 协议（Internet Protocol）是互联网的核心 ARP 协议用于查询同一网络中的 <主机 IP 地址, MAC 地址> 之间的映射关系 ICMP 协议用于网络层实体之间互相通知“异常事件” IGMP 协议用于实现 IP 组播 IP 数据报的格式 IP 数据报的格式I...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"IPv4\\",\\"image\\":[\\"https://store.s1r0ko.top/svg/m/cn/20/1_ver_1.svg\\",\\"//store.s1r0ko.top/svg/m/cn/20/2_ver_2.svg\\",\\"//store.s1r0ko.top/svg/m/cn/20/3_ver_1.svg\\",\\"//store.s1r0ko.top/svg/m/cn/20/4_ver_2.svg\\"],\\"datePublished\\":\\"2025-07-23T00:00:00.000Z\\",\\"dateModified\\":\\"2025-07-25T11:54:55.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"KurimulaAiri\\",\\"url\\":\\"https://github.com/KurimulaAiri\\"}]}"],["meta",{"property":"og:url","content":"https://md.s1r0ko.top/art/learning/master/major/ComputerNetworks/IPv4.html"}],["meta",{"property":"og:site_name","content":"博客与资料库"}],["meta",{"property":"og:title","content":"IPv4"}],["meta",{"property":"og:description","content":"IPv4 协议 各层协议之间关系各层协议之间关系 提示 各层协议之中， IP 协议（Internet Protocol）是互联网的核心 ARP 协议用于查询同一网络中的 <主机 IP 地址, MAC 地址> 之间的映射关系 ICMP 协议用于网络层实体之间互相通知“异常事件” IGMP 协议用于实现 IP 组播 IP 数据报的格式 IP 数据报的格式I..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://store.s1r0ko.top/svg/m/cn/20/1_ver_1.svg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-07-25T11:54:55.000Z"}],["meta",{"property":"article:published_time","content":"2025-07-23T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-07-25T11:54:55.000Z"}]]},"git":{"createdTime":1753276972000,"updatedTime":1753444495000,"contributors":[{"name":"KurimulaAiri","username":"KurimulaAiri","email":"1095370199@qq.com","commits":5,"url":"https://github.com/KurimulaAiri"}]},"readingTime":{"minutes":7.05,"words":2114},"filePathRelative":"art/learning/master/major/ComputerNetworks/IPv4.md","excerpt":"<h2>IPv4 协议</h2>\\n<figure><img src=\\"https://store.s1r0ko.top/svg/m/cn/20/1_ver_1.svg\\" alt=\\"各层协议之间关系\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>各层协议之间关系</figcaption></figure>\\n<div class=\\"hint-container tip\\">\\n<p class=\\"hint-container-title\\">提示</p>\\n<p>各层协议之中， <strong id=\\"red-msg\\">IP 协议（Internet Protocol）是互联网的核心</strong></p>\\n<p>ARP 协议用于查询同一网络中的 <code>&lt;主机 IP 地址, MAC 地址&gt;</code> 之间的映射关系</p>\\n<p>ICMP 协议用于网络层实体之间互相通知“异常事件”</p>\\n<p>IGMP 协议用于实现 IP 组播</p>\\n</div>","autoDesc":true}');export{I as comp,f as data};
